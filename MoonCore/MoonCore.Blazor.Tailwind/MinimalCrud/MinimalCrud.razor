@using MoonCore.Blazor.Tailwind.DataTable

@typeparam TItem

@inject NavigationManager Navigation

<ItemDataTable TItem="TItem"
               ItemLoader="CrudOptions.ItemLoader"
               PageSize="CrudOptions.PageSize">
    <ChildContent>
        <DataColumn TItem="TItem" CssClasses="pl-2 w-5" HeadCssClasses="pl-2 w-5">
            <HeadTemplate>
                <div class="pr-1">
                    <input type="checkbox" class="h-4 w-4 rounded bg-slate-900 border-slate-700 text-indigo-600">
                </div>
            </HeadTemplate>
            <Template>
                <div class="pr-1">
                    <input type="checkbox" class="h-4 w-4 rounded bg-slate-900 border-slate-700 text-indigo-600">
                </div>
            </Template>
        </DataColumn>

        @ChildContent

        <DataColumn TItem="TItem" Title="Actions" CssClasses="p-1">
            <HeadTemplate>
                <div class="flex items-center justify-end mr-2">Actions</div>
            </HeadTemplate>
            <Template>
                <div class="flex justify-end mr-2">
                    @if (CrudOptions.UpdateUrl != null)
                    {
                        <a href="#" @onclick="() => StartUpdate(context)" @onclick:preventDefault
                           class="text-primary-500 mr-2 sm:mr-3">
                            <i class="icon-pencil text-base"></i>
                        </a>
                    }

                    @if (CrudOptions.DeleteUrl != null || CrudOptions.DeleteFunction != null)
                    {
                        <a href="#" @onclick="() => StartDelete(context)" @onclick:preventDefault
                           class="text-danger-500">
                            <i class="icon-trash text-base"></i>
                        </a>
                    }
                </div>
            </Template>
        </DataColumn>
    </ChildContent>
    <ActionBarTemplate>
        @if (!string.IsNullOrEmpty(CrudOptions.CreateUrl))
        {
            <a href="@CrudOptions.CreateUrl" class="btn btn-primary mr-2">
                Create
            </a>
        }
    </ActionBarTemplate>
</ItemDataTable>

@code
{
    [Parameter] public RenderFragment ChildContent { get; set; }
    [Parameter] public Action<MinimalCrudOptions<TItem>> OnConfigure { get; set; }

    private MinimalCrudOptions<TItem> CrudOptions = new();

    protected override void OnInitialized()
    {
        ArgumentNullException.ThrowIfNull(OnConfigure);
        OnConfigure.Invoke(CrudOptions);
    }

    private void StartUpdate(TItem item)
    {
        var url = CrudOptions.UpdateUrl!.Invoke(item);
        Navigation.NavigateTo(url);
    }

    private void StartDelete(TItem item)
    {
        if (CrudOptions.DeleteFunction != null)
        {
        }
        else if (CrudOptions.DeleteUrl != null)
        {
            var url = CrudOptions.DeleteUrl.Invoke(item);
            Navigation.NavigateTo(url);
        }
    }
}
